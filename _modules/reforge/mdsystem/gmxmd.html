

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>reforge.mdsystem.gmxmd &mdash; reForge 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=dc75d08a" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            reForge
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../why.html">Why use reForge?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">reForge API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">reForge</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">reforge.mdsystem.gmxmd</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for reforge.mdsystem.gmxmd</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;File: gmxmd.py</span>

<span class="sd">Description:</span>
<span class="sd">    This module provides classes and functions for setting up, running, and</span>
<span class="sd">    analyzing molecular dynamics (MD) simulations using GROMACS. The main</span>
<span class="sd">    classes include:</span>

<span class="sd">      - GmxSystem: Provides methods to prepare simulation files, process PDB</span>
<span class="sd">        files, run GROMACS commands, and perform various analyses on MD data.</span>
<span class="sd">      - MDRun: A subclass of GmxSystem dedicated to executing MD simulations and</span>
<span class="sd">        performing post-processing tasks (e.g., RMSF, RMSD, covariance analysis).</span>

<span class="sd">Usage:</span>
<span class="sd">    Import this module and instantiate the GmxSystem or MDRun classes to set up</span>
<span class="sd">    and run your MD simulations.</span>

<span class="sd">Requirements:</span>
<span class="sd">    - Python 3.x</span>
<span class="sd">    - MDAnalysis</span>
<span class="sd">    - NumPy</span>
<span class="sd">    - Pandas</span>
<span class="sd">    - GROMACS (with CLI tools such as gmx_mpi, gmx, etc.)</span>
<span class="sd">    - The reforge package and its dependencies</span>

<span class="sd">Author: DY</span>
<span class="sd">Date: 2025-02-27</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">importlib.resources</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reforge</span><span class="w"> </span><span class="kn">import</span> <span class="n">cli</span><span class="p">,</span> <span class="n">pdbtools</span><span class="p">,</span> <span class="n">io</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reforge.pdbtools</span><span class="w"> </span><span class="kn">import</span> <span class="n">AtomList</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reforge.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">cd</span><span class="p">,</span> <span class="n">clean_dir</span><span class="p">,</span> <span class="n">logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reforge.mdsystem.mdsystem</span><span class="w"> </span><span class="kn">import</span> <span class="n">MDSystem</span><span class="p">,</span> <span class="n">MDRun</span>

<span class="c1">################################################################################</span>
<span class="c1"># GMX system class</span>
<span class="c1">################################################################################</span>

<div class="viewcode-block" id="GmxSystem">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GmxSystem</span><span class="p">(</span><span class="n">MDSystem</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to set up and analyze protein-nucleotide-lipid systems for MD</span>
<span class="sd">    simulations using GROMACS.</span>

<span class="sd">    Most attributes are paths to files and directories needed to set up</span>
<span class="sd">    and run the MD simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MDATDIR</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;reforge&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;martini&quot;</span> <span class="o">/</span> <span class="s2">&quot;datdir&quot;</span>
    <span class="n">MMDPDIR</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;reforge&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;martini&quot;</span> <span class="o">/</span> <span class="s2">&quot;datdir&quot;</span> <span class="o">/</span> <span class="s2">&quot;mdp&quot;</span>
    <span class="n">MITPDIR</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">&quot;reforge&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;martini&quot;</span> <span class="o">/</span> <span class="s2">&quot;itp&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sysdir</span><span class="p">,</span> <span class="n">sysname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the MD system with required directories and file paths.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            sysdir (str): Base directory for the system files.</span>
<span class="sd">            sysname (str): Name of the MD system.</span>

<span class="sd">        Sets up paths for various files required for coarse-grained MD simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sysdir</span><span class="p">,</span> <span class="n">sysname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;system.gro&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">systop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;system.top&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;system.ndx&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;mdp&quot;</span>
        <span class="c1"># Define gro directory (used in make_gro_file)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grodir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;gro&quot;</span>

<div class="viewcode-block" id="GmxSystem.gmx">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.gmx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gmx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clean_wdir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes a GROMACS command from the system&#39;s root directory. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            command (str): The GROMACS command to run (default: &quot;-h&quot;).</span>
<span class="sd">            clinput (str, optional): Input to pass to the command&#39;s stdin.</span>
<span class="sd">            clean_wdir (bool, optional): If True, cleans the working directory after execution.</span>
<span class="sd">            kwargs: Additional keyword arguments to pass to gromacs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clean_wdir</span><span class="p">:</span>
                <span class="n">clean_dir</span><span class="p">()</span></div>


<div class="viewcode-block" id="GmxSystem.prepare_files">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.prepare_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares the simulation by creating necessary directories and copying input files.</span>

<span class="sd">        The method:</span>
<span class="sd">          - Creates directories for proteins, nucleotides, topologies, maps, mdp files,</span>
<span class="sd">            coarse-grained PDBs, GRO files, MD runs, data, and PNG outputs.</span>
<span class="sd">          - Copies .mdp files from the master MDP directory.</span>
<span class="sd">          - Copies &#39;water.gro&#39; and &#39;atommass.dat&#39; from the master data directory.</span>
<span class="sd">          - Copies .itp files from the master ITP directory to the system topology directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preparing files and directories&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prodir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cgdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pngdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Copy .mdp files from master MDP directory</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MMDPDIR</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mdp&quot;</span><span class="p">):</span>
                <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">outpath</span><span class="p">)</span>
        <span class="c1"># Copy water.gro and atommass.dat from master data directory</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MDATDIR</span> <span class="o">/</span> <span class="s2">&quot;water.gro&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MDATDIR</span> <span class="o">/</span> <span class="s2">&quot;atommass.dat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># Copy .itp files from master ITP directory</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MITPDIR</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.itp&quot;</span><span class="p">):</span>
                <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topdir</span> <span class="o">/</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">outpath</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.make_cg_structure">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.make_cg_structure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_cg_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merges coarse-grained PDB files into a single solute PDB file.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Merging CG PDB files into a single solute PDB...&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
            <span class="n">cg_pdb_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgdir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()]</span>
            <span class="n">cg_pdb_files</span> <span class="o">=</span> <span class="n">pdbtools</span><span class="o">.</span><span class="n">sort_uld</span><span class="p">(</span><span class="n">cg_pdb_files</span><span class="p">)</span>
            <span class="n">cg_pdb_files</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cgdir</span> <span class="o">/</span> <span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">cg_pdb_files</span><span class="p">]</span>
            <span class="n">all_atoms</span> <span class="o">=</span> <span class="n">AtomList</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cg_pdb_files</span><span class="p">:</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">pdbtools</span><span class="o">.</span><span class="n">pdb2atomlist</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">all_atoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">all_atoms</span><span class="o">.</span><span class="n">renumber</span><span class="p">()</span>
            <span class="n">all_atoms</span><span class="o">.</span><span class="n">write_pdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solupdb</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.make_box">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.make_box">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets up simulation box with GROMACS editconf command.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional keyword arguments for the GROMACS editconf command. Defaults:</span>
<span class="sd">                - d: Distance parameter (default: 1.0)</span>
<span class="sd">                - bt: Box type (default: &quot;dodecahedron&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;bt&quot;</span><span class="p">,</span> <span class="s2">&quot;dodecahedron&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s2">&quot;editconf&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solupdb</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">solupdb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.make_cg_topology">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.make_cg_topology">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_cg_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_resolved_ions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;chain&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the system topology file by including all relevant ITP files and</span>
<span class="sd">        defining the system and molecule sections.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            add_resolved_ions (bool, optional): If True, counts and includes resolved ions.</span>
<span class="sd">            prefix (str, optional): Prefix for ITP files to include (default: &quot;chain&quot;).</span>

<span class="sd">        Writes the topology file (self.systop) with include directives and molecule counts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing system topology...&quot;</span><span class="p">)</span>
        <span class="n">itp_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topdir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">*itp&#39;</span><span class="p">)]</span>
        <span class="n">itp_files</span> <span class="o">=</span> <span class="n">pdbtools</span><span class="o">.</span><span class="n">sort_uld</span><span class="p">(</span><span class="n">itp_files</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># Include section</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#define GO_VIRT&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#define RUBBER_BANDS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/martini_v3.0.0.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/martini_v3.0.0_rna.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/martini_ions.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;go_atomtypes.itp&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topdir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/go_atomtypes.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/go_nbparams.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/martini_v3.0.0_solvents_v1.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/martini_v3.0.0_phospholipids_v1.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#include &quot;topol/martini_v3.0.0_ions_v1.itp&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">itp_files</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;#include &quot;topol/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># System name and molecule count</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ system ]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Martini system for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sysname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[molecules]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;; name</span><span class="se">\t\t</span><span class="s2">number</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">itp_files</span><span class="p">:</span>
                <span class="n">molecule_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">molecule_name</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Add resolved ions if requested.</span>
            <span class="k">if</span> <span class="n">add_resolved_ions</span><span class="p">:</span>
                <span class="n">ions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_resolved_ions</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">ion</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">ions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ion</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.make_gro_file">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.make_gro_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_gro_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">bt</span><span class="o">=</span><span class="s2">&quot;dodecahedron&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates the final GROMACS GRO file from coarse-grained PDB files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            d (float, optional): Distance parameter for the editconf command (default: 1.25).</span>
<span class="sd">            bt (str, optional): Box type for the editconf command (default: &quot;dodecahedron&quot;).</span>

<span class="sd">        Converts PDB files to GRO files, merges them, and adjusts the system box.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
            <span class="n">cg_pdb_files</span> <span class="o">=</span> <span class="n">pdbtools</span><span class="o">.</span><span class="n">sort_uld</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgdir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()])</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">cg_pdb_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pdb&quot;</span><span class="p">):</span>
                    <span class="n">pdb_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgdir</span> <span class="o">/</span> <span class="n">file</span>
                    <span class="c1"># Replace suffix and directory component as in the original string manipulation</span>
                    <span class="n">gro_file_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;.gro&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;cgpdb&quot;</span><span class="p">,</span> <span class="s2">&quot;gro&quot;</span><span class="p">)</span>
                    <span class="n">gro_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">gro_file_str</span><span class="p">)</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;gmx_mpi editconf -f </span><span class="si">{</span><span class="n">pdb_file</span><span class="si">}</span><span class="s2"> -o </span><span class="si">{</span><span class="n">gro_file</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">sp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Merge all .gro files.</span>
            <span class="n">gro_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grodir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()])</span>
            <span class="n">total_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">gro_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gro&quot;</span><span class="p">):</span>
                    <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grodir</span> <span class="o">/</span> <span class="n">filename</span>
                    <span class="k">with</span> <span class="n">filepath</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_f</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">in_f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                        <span class="n">atom_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">total_count</span> <span class="o">+=</span> <span class="n">atom_count</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_f</span><span class="p">:</span>
                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sysname</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">total_count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">gro_files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gro&quot;</span><span class="p">):</span>
                        <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grodir</span> <span class="o">/</span> <span class="n">filename</span>
                        <span class="k">with</span> <span class="n">filepath</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_f</span><span class="p">:</span>
                            <span class="n">lines</span> <span class="o">=</span> <span class="n">in_f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;10.00000   10.00000   10.00000</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;gmx_mpi editconf -f </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span><span class="si">}</span><span class="s2"> -d </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> -bt </span><span class="si">{</span><span class="n">bt</span><span class="si">}</span><span class="s2">  -o </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">sp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.solvate">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.solvate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">solvate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solvates the system using GROMACS solvate command.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for the solvate command. Defaults:</span>
<span class="sd">                - cp: &quot;solute.pdb&quot;</span>
<span class="sd">                - cs: &quot;water.gro&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cp&quot;</span><span class="p">,</span> <span class="s2">&quot;solute.pdb&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cs&quot;</span><span class="p">,</span> <span class="s2">&quot;water.gro&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s2">&quot;solvate&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syspdb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.add_bulk_ions">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.add_bulk_ions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_bulk_ions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Adds bulk ions to neutralize the system using GROMACS genion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        solvent (str, optional): </span>
<span class="sd">            Solvent residue name (default: &quot;W&quot;).</span>
<span class="sd">        kwargs (dict):</span>
<span class="sd">            Additional parameters for genion. Defaults include:</span>
<span class="sd">            - conc: 0.15</span>
<span class="sd">            - pname: &quot;NA&quot;</span>
<span class="sd">            - nname: &quot;CL&quot;</span>
<span class="sd">            - neutral: &quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;conc&quot;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;pname&quot;</span><span class="p">,</span> <span class="s2">&quot;NA&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;nname&quot;</span><span class="p">,</span> <span class="s2">&quot;CL&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;neutral&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s2">&quot;grompp&quot;</span><span class="p">,</span>
            <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">/</span> <span class="s2">&quot;ions.mdp&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syspdb</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="s2">&quot;ions.tpr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s2">&quot;genion&quot;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">solvent</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">s</span><span class="o">=</span><span class="s2">&quot;ions.tpr&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syspdb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s2">&quot;editconf&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syspdb</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span><span class="p">)</span>
        <span class="n">clean_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;ions.tpr&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.make_system_ndx">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.make_system_ndx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_system_ndx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backbone_atoms</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;C1&#39;&quot;</span><span class="p">),</span> <span class="n">water_resname</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an index (NDX) file for the system, separating solute, </span>
<span class="sd">        backbone, solvent, and individual chains.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            backbone_atoms : list, optional</span>
<span class="sd">                List of atom names to include in the backbone (default: [&quot;CA&quot;, &quot;P&quot;, &quot;C1&#39;&quot;]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Making index file from </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">syspdb</span><span class="p">)</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">pdbtools</span><span class="o">.</span><span class="n">pdb2atomlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syspdb</span><span class="p">)</span>
        <span class="n">solute</span> <span class="o">=</span> <span class="n">pdbtools</span><span class="o">.</span><span class="n">pdb2atomlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solupdb</span><span class="p">)</span>
        <span class="n">solvent</span> <span class="o">=</span> <span class="n">AtomList</span><span class="p">(</span><span class="n">system</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">solute</span><span class="p">):])</span>
        <span class="n">backbone</span> <span class="o">=</span> <span class="n">solute</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">backbone_atoms</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">not_water</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">mask_out</span><span class="p">(</span><span class="n">water_resname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;resname&#39;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">write_ndx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;[ System ]&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">solute</span><span class="o">.</span><span class="n">write_ndx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;[ Solute ]&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">backbone</span><span class="o">.</span><span class="n">write_ndx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;[ Backbone ]&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">solvent</span><span class="o">.</span><span class="n">write_ndx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;[ Solvent ]&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">not_water</span><span class="o">.</span><span class="n">write_ndx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;[ Not_Water ]&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">chids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">solute</span><span class="o">.</span><span class="n">chids</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">chid</span> <span class="ow">in</span> <span class="n">chids</span><span class="p">:</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="n">solute</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">chid</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;chid&quot;</span><span class="p">)</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">write_ndx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[ chain_</span><span class="si">{</span><span class="n">chid</span><span class="si">}</span><span class="s2"> ]&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Written index to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxSystem.initmd">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxSystem.initmd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">initmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes a new GMX MD run.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            runname (str): Name for the MD run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MDRun: An instance of the MDRun class for the specified run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mdrun</span> <span class="o">=</span> <span class="n">MDRun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sysdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysname</span><span class="p">,</span> <span class="n">runname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mdrun</span></div>
</div>



<div class="viewcode-block" id="GmxRun">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GmxRun</span><span class="p">(</span><span class="n">MDRun</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subclass of GmxSystem for executing molecular dynamics (MD) simulations</span>
<span class="sd">    and performing post-processing analyses.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sysdir</span><span class="p">,</span> <span class="n">sysname</span><span class="p">,</span> <span class="n">runname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the MD run environment with additional directories for analysis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            sysdir (str): Base directory for the system.</span>
<span class="sd">            sysname (str): Name of the MD system.</span>
<span class="sd">            runname (str): Name for the MD run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sysdir</span><span class="p">,</span> <span class="n">sysname</span><span class="p">,</span> <span class="n">runname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;system.gro&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">systop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;system.top&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;system.ndx&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;mdp&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span> <span class="o">/</span> <span class="s2">&quot;mdc.pdb&quot;</span>  <span class="c1"># Structure file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span> <span class="o">/</span> <span class="s2">&quot;mdc.trr&quot;</span>  <span class="c1"># Trajectory file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span> <span class="o">/</span> <span class="s2">&quot;mdc.xtc&quot;</span>

<div class="viewcode-block" id="GmxRun.gmx">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.gmx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gmx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clean_wdir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes a GROMACS command from the run&#39;s root directory. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            command (str): The GROMACS command to run (default: &quot;-h&quot;).</span>
<span class="sd">            clinput (str, optional): Input to pass to the command&#39;s stdin.</span>
<span class="sd">            clean_wdir (bool, optional): If True, cleans the working directory after execution.</span>
<span class="sd">            kwargs: Additional keyword arguments to pass to gromacs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clean_wdir</span><span class="p">:</span>
                <span class="n">clean_dir</span><span class="p">()</span></div>


<div class="viewcode-block" id="GmxRun.empp">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.empp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">empp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares the energy minimization run using GROMACS grompp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for grompp. Defaults include:</span>
<span class="sd">                - f: Path to .mdp file.</span>
<span class="sd">                - c: Structure file.</span>
<span class="sd">                - r: Reference structure.</span>
<span class="sd">                - p: Topology file.</span>
<span class="sd">                - n: Index file.</span>
<span class="sd">                - o: Output TPR file (&quot;em.tpr&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">/</span> <span class="s2">&quot;em_cg.mdp&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysgro</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;em.tpr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;grompp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.hupp">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.hupp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hupp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares the heat-up phase using GROMACS grompp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for grompp. Defaults include:</span>
<span class="sd">                - f: Path to .mdp file</span>
<span class="sd">                - c: Starting structure (&quot;em.gro&quot;).</span>
<span class="sd">                - r: Reference structure (&quot;em.gro&quot;).</span>
<span class="sd">                - p: Topology file.</span>
<span class="sd">                - n: Index file.</span>
<span class="sd">                - o: Output TPR file (&quot;hu.tpr&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">/</span> <span class="s2">&quot;hu_cg.mdp&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;em.gro&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;em.gro&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;hu.tpr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;grompp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.eqpp">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.eqpp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eqpp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares the equilibration phase using GROMACS grompp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for grompp. Defaults include:</span>
<span class="sd">                - f: Path to .mdp file.</span>
<span class="sd">                - c: Starting structure (&quot;hu.gro&quot;).</span>
<span class="sd">                - r: Reference structure (&quot;hu.gro&quot;).</span>
<span class="sd">                - p: Topology file.</span>
<span class="sd">                - n: Index file.</span>
<span class="sd">                - o: Output TPR file (&quot;eq.tpr&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">/</span> <span class="s2">&quot;eq_cg.mdp&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;hu.gro&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;hu.gro&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;eq.tpr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;grompp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.mdpp">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.mdpp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mdpp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares the production MD run using GROMACS grompp.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for grompp. Defaults include:</span>
<span class="sd">                - f: Path to .mdp file.</span>
<span class="sd">                - c: Starting structure (&quot;eq.gro&quot;).</span>
<span class="sd">                - r: Reference structure (&quot;eq.gro&quot;).</span>
<span class="sd">                - p: Topology file.</span>
<span class="sd">                - n: Index file.</span>
<span class="sd">                - o: Output TPR file (&quot;md.tpr&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdpdir</span> <span class="o">/</span> <span class="s2">&quot;md_cg.mdp&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;eq.gro&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;eq.gro&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">systop</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;md.tpr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;grompp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.mdrun">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.mdrun">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mdrun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the production MD run using GROMACS mdrun.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for mdrun. Defaults include:</span>
<span class="sd">                - deffnm: &quot;md&quot;</span>
<span class="sd">                - nsteps: &quot;-2&quot;</span>
<span class="sd">                - ntomp: &quot;8&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;deffnm&quot;</span><span class="p">,</span> <span class="s2">&quot;md&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;nsteps&quot;</span><span class="p">,</span> <span class="s2">&quot;-2&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;ntomp&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;mdrun&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.trjconv">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.trjconv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">trjconv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts trajectories using GROMACS trjconv.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input to be passed to trjconv.</span>
<span class="sd">            kwargs: Additional parameters for trjconv.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;trjconv&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.convert_tpr">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.convert_tpr">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_tpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts TPR files using GROMACS convert-tpr.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;convert-tpr&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   </div>


<div class="viewcode-block" id="GmxRun.rmsf">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.rmsf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rmsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates RMSF using GROMACS rmsf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the rmsf command.</span>
<span class="sd">            kwargs: Additional parameters for rmsf. Defaults include:</span>
<span class="sd">                - s: Structure file.</span>
<span class="sd">                - f: Trajectory file.</span>
<span class="sd">                - o: Output xvg file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xvg_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmsdir</span> <span class="o">/</span> <span class="s2">&quot;rmsf.xvg&quot;</span>
        <span class="n">npy_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmsdir</span> <span class="o">/</span> <span class="s2">&quot;rmsf.npy&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">xvg_file</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;xvg&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;rmsf&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">xvg2npy</span><span class="p">(</span><span class="n">xvg_file</span><span class="p">,</span> <span class="n">npy_file</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="GmxRun.rmsd">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.rmsd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rmsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates RMSD using GROMACS rms.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the rms command.</span>
<span class="sd">            kwargs: Additional parameters for rms. Defaults include:</span>
<span class="sd">                - s: Structure file.</span>
<span class="sd">                - f: Trajectory file.</span>
<span class="sd">                - o: Output xvg file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xvg_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmsdir</span> <span class="o">/</span> <span class="s2">&quot;rmsd.xvg&quot;</span>
        <span class="n">npy_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmsdir</span> <span class="o">/</span> <span class="s2">&quot;rmsd.npy&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">xvg_file</span><span class="p">))</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;xvg&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;rms&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">xvg2npy</span><span class="p">(</span><span class="n">xvg_file</span><span class="p">,</span> <span class="n">npy_file</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="GmxRun.rdf">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.rdf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the radial distribution function using GROMACS rdf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the rdf command.</span>
<span class="sd">            kwargs: Additional parameters for rdf. Defaults include:</span>
<span class="sd">                - f: Trajectory file.</span>
<span class="sd">                - s: Structure file.</span>
<span class="sd">                - n: Index file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;mdc.xtc&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;mdc.pdb&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;xvg&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;rdf&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.cluster">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.cluster">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs clustering using GROMACS cluster.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the clustering command.</span>
<span class="sd">            kwargs: Additional parameters for cluster.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cludir</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.extract_cluster">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.extract_cluster">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts frames belonging to a cluster using GROMACS extract-cluster.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the extract-cluster command.</span>
<span class="sd">            kwargs: Additional parameters for extract-cluster. Defaults include:</span>
<span class="sd">            - clusters: &quot;cluster.ndx&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;clusters&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster.ndx&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cludir</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;extract_cluster&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.covar">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.covar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">covar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates and diagonalizes the covariance matrix using GROMACS covar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the covar command.</span>
<span class="sd">            kwargs: Additional parameters for covar. Defaults include:</span>
<span class="sd">            - f: Trajectory file.</span>
<span class="sd">            - s: Structure file.</span>
<span class="sd">            - n: Index file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covdir</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;covar&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.anaeig">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.anaeig">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">anaeig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Analyzes eigenvectors using GROMACS anaeig.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the anaeig command.</span>
<span class="sd">            kwargs: Additional parameters for anaeig. Defaults include:</span>
<span class="sd">            - f: Trajectory file.</span>
<span class="sd">            - s: Structure file.</span>
<span class="sd">            - v: Output eigenvector file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;eigenvec.trr&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covdir</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;anaeig&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.make_edi">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.make_edi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_edi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares files for essential dynamics analysis using GROMACS make-edi.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            clinput (str, optional): Input for the make-edi command.</span>
<span class="sd">            kwargs: Additional parameters for make-edi. Defaults include:</span>
<span class="sd">            - f: Eigenvector file.</span>
<span class="sd">            - s: Structure file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;eigenvec.trr&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">covdir</span><span class="p">):</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;make_edi&#39;</span><span class="p">,</span> <span class="n">clinput</span><span class="o">=</span><span class="n">clinput</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.get_rmsf_by_chain">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.get_rmsf_by_chain">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rmsf_by_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates RMSF for each chain in the system using GROMACS rmsf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for the rmsf command. Defaults include:</span>
<span class="sd">            - f: Trajectory file.</span>
<span class="sd">            - s: Structure file.</span>
<span class="sd">            - n: Index file.</span>
<span class="sd">            - res: Whether to output per-residue RMSF (default: &quot;no&quot;).</span>
<span class="sd">            - fit: Whether to fit the trajectory (default: &quot;yes&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;res&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;rmsf&#39;</span><span class="p">,</span>
                <span class="n">clinput</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">o</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;rmsf_</span><span class="si">{</span><span class="n">chain</span><span class="si">}</span><span class="s2">.xvg&quot;</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="GmxRun.get_rmsd_by_chain">
<a class="viewcode-back" href="../../../reforge.mdsystem.html#reforge.mdsystem.gmxmd.GmxRun.get_rmsd_by_chain">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rmsd_by_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates RMSD for each chain in the system using GROMACS rmsd.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            kwargs: Additional parameters for the rmsd command. Defaults include:</span>
<span class="sd">            - f: Trajectory file.</span>
<span class="sd">            - s: Structure file.</span>
<span class="sd">            - n: Index file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trj</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sysndx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">cli</span><span class="o">.</span><span class="n">gmx</span><span class="p">(</span><span class="s1">&#39;rms&#39;</span><span class="p">,</span>
                <span class="n">clinput</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">o</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmsdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;rmsf_</span><span class="si">{</span><span class="n">chain</span><span class="si">}</span><span class="s2">.xvg&quot;</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Danis Yangaliev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>